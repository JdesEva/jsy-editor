"use strict";function createElemByHTML(t){var e=document.createElement("div");return e.innerHTML=t,e.children}function isDOMList(t){return!!t&&(t instanceof HTMLCollection||t instanceof NodeList)}function querySelectorAll(t){var e=document.querySelectorAll(t);return isDOMList(e)?e:[e]}var eventList=[];function DomElement(t){if(t){if(t instanceof DomElement)return t;var e=(this.selector=t).nodeType,n=[];9===e?n=[t]:1===e?n=[t]:isDOMList(t)||t instanceof Array?n=t:"string"==typeof t&&(n=0===(t=t.replace("/\n/mg","").trim()).indexOf("<")?createElemByHTML(t):querySelectorAll(t));var i,o=n.length;if(!o)return this;for(i=0;i<o;i++)this[i]=n[i];this.length=o}}function $(t){return new DomElement(t)}DomElement.prototype={constructor:DomElement,forEach:function(t){var e;for(e=0;e<this.length;e++){var n=this[e];if(!1===t.call(n,n,e))break}return this},clone:function(e){var n=[];return this.forEach(function(t){n.push(t.cloneNode(!!e))}),$(n)},get:function(t){var e=this.length;return e<=t&&(t%=e),$(this[t])},first:function(){return this.get(0)},last:function(){var t=this.length;return this.get(t-1)},on:function(t,n,i){i||(i=n,n=null);var o=[];return o=t.split(/\s+/),this.forEach(function(e){o.forEach(function(t){t&&(eventList.push({elem:e,type:t,fn:i}),n?e.addEventListener(t,function(t){var e=t.target;e.matches(n)&&i.call(e,t)}):e.addEventListener(t,i))})})},off:function(e,n){return this.forEach(function(t){t.removeEventListener(e,n)})},attr:function(e,n){return null==n?this[0].getAttribute(e):this.forEach(function(t){t.setAttribute(e,n)})},addClass:function(n){return n?this.forEach(function(t){var e;t.className?((e=(e=t.className.split(/\s/)).filter(function(t){return!!t.trim()})).indexOf(n)<0&&e.push(n),t.className=e.join(" ")):t.className=n}):this},removeClass:function(n){return n?this.forEach(function(t){var e;t.className&&(e=(e=t.className.split(/\s/)).filter(function(t){return!(!(t=t.trim())||t===n)}),t.className=e.join(" "))}):this},css:function(i,t){var o="".concat(i,":").concat(t,";");return this.forEach(function(t){var e=(t.getAttribute("style")||"").trim(),n=[];e?(e.split(";").forEach(function(t){var e=t.split(":").map(function(t){return t.trim()});2===e.length&&n.push(e[0]+":"+e[1])}),(n=n.map(function(t){return 0===t.indexOf(i)?o:t})).indexOf(o)<0&&n.push(o),t.setAttribute("style",n.join("; "))):t.setAttribute("style",o)})},show:function(){return this.css("display","block")},hide:function(){return this.css("display","none")},children:function(){var t=this[0];return t?$(t.children):null},childNodes:function(){var t=this[0];return t?$(t.childNodes):null},append:function(t){return this.forEach(function(e){t.forEach(function(t){e.appendChild(t)})})},remove:function(){return this.forEach(function(t){if(t.remove)t.remove();else{var e=t.parentElement;e&&e.removeChild(t)}})},isContain:function(t){var e=this[0],n=t[0];return e.contains(n)},getSizeData:function(){return this[0].getBoundingClientRect()},getNodeName:function(){return this[0].nodeName},find:function(t){return $(this[0].querySelectorAll(t))},text:function(e){return e?this.forEach(function(t){t.innerHTML=e}):this[0].innerHTML.replace(/<.*?>/g,function(){return""})},html:function(t){var e=this[0];return null==t?e.innerHTML:(e.innerHTML=t,this)},val:function(){return this[0].value.trim()},focus:function(){return this.forEach(function(t){t.focus()})},parent:function(){return $(this[0].parentElement)},parentUntil:function(t,e){var n=document.querySelectorAll(t),i=n.length;if(!i)return null;var o=e||this[0];if("BODY"===o.nodeName)return null;var r,a=o.parentElement;for(r=0;r<i;r++)if(a===n[r])return $(a);return this.parentUntil(t,a)},equal:function(t){return 1===t.nodeType?this[0]===t:this[0]===t[0]},insertBefore:function(t){var e=$(t)[0];return e?this.forEach(function(t){e.parentNode.insertBefore(t,e)}):this},insertAfter:function(t){var n=$(t)[0];return n?this.forEach(function(t){var e=n.parentNode;e.lastChild===n?e.appendChild(t):e.insertBefore(t,n.nextSibling)}):this}},$.offAll=function(){eventList.forEach(function(t){var e=t.elem,n=t.type,i=t.fn;e.removeEventListener(n,i)})};var config={menus:["head","bold","fontSize","fontName","italic","underline","strikeThrough","foreColor","backColor","link","list","justify","quote","emoticon","image","table","video","code","undo","redo"],fontNames:["ÂÆã‰Ωì","ÂæÆËΩØÈõÖÈªë","Arial","Tahoma","Verdana"],colors:["#000000","#eeece0","#1c487f","#4d80bf","#c24f4a","#8baa4a","#7b5ba1","#46acc8","#f9963b","#ffffff"],emotions:[{title:"ÈªòËÆ§",type:"image",content:[{alt:"[ÂùèÁ¨ë]",src:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/50/pcmoren_huaixiao_org.png"},{alt:"[ËàîÂ±è]",src:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/40/pcmoren_tian_org.png"},{alt:"[Ê±°]",src:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/3c/pcmoren_wu_org.png"}]},{title:"Êñ∞Êµ™",type:"image",content:[{src:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/7a/shenshou_thumb.gif",alt:"[ËçâÊ≥•È©¨]"},{src:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/60/horse2_thumb.gif",alt:"[Á•ûÈ©¨]"},{src:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/bc/fuyun_thumb.gif",alt:"[ÊµÆ‰∫ë]"}]},{title:"emoji",type:"emoji",content:"üòÄ üòÉ üòÑ üòÅ üòÜ üòÖ üòÇ üòä üòá üôÇ üôÉ üòâ üòì üò™ üò¥ üôÑ ü§î üò¨ ü§ê".split(/\s/)}],zIndex:1e4,debug:!1,linkCheck:function(){return!0},linkImgCheck:function(){return!0},pasteFilterStyle:!0,pasteIgnoreImg:!1,pasteTextHandle:function(t){return t},showLinkImg:!0,linkImgCallback:function(){},uploadImgMaxSize:5242880,uploadImgShowBase64:!1,uploadFileName:"",uploadImgParams:{},uploadImgHeaders:{},withCredentials:!1,uploadImgTimeout:1e4,uploadImgHooks:{before:function(){},success:function(){},fail:function(){},error:function(){},timeout:function(){}},qiniu:!1},UA={_ua:navigator.userAgent,isWebkit:function(){return/webkit/i.test(this._ua)},isIE:function(){return"ActiveXObject"in window}};function objForEach(t,e){var n;for(n in t)if(t.hasOwnProperty(n)&&!1===e.call(t,n,t[n]))break}function arrForEach(t,e){var n,i,o=t.length||0;for(n=0;n<o&&(i=t[n],!1!==e.call(t,i,n));n++);}function getRandom(t){return t+Math.random().toString().slice(2)}function replaceHtmlSymbol(t){return null==t?"":t.replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;").replace(/(\r\n|\r|\n)/g,"<br/>")}function isFunction(t){return"function"==typeof t}function Bold(t){this.editor=t,this.$elem=$('<div class="w-e-menu">\n            <i class="w-e-icon-bold"></i>\n        </div>'),this.type="click",this._active=!1}function replaceLang(t,e){var n=t.config.langArgs||[],i=e;return n.forEach(function(t){var e=t.reg,n=t.val;e.test(i)&&(i=i.replace(e,function(){return n}))}),i}Bold.prototype={constructor:Bold,onClick:function(){var t=this.editor,e=t.selection.isSelectionEmpty();e&&t.selection.createEmptyRange(),t.cmd.do("bold"),e&&(t.selection.collapseRange(),t.selection.restoreSelection())},tryChangeActive:function(){var t=this.editor,e=this.$elem;t.cmd.queryCommandState("bold")?(this._active=!0,e.addClass("w-e-active")):(this._active=!1,e.removeClass("w-e-active"))}};var _emptyFn=function(){};function DropList(t,e){var r=this,a=t.editor;this.menu=t,this.opt=e;var n,i=$('<div class="w-e-droplist"></div>'),o=e.$title;o&&(n=o.html(),n=replaceLang(a,n),o.html(n),o.addClass("w-e-dp-title"),i.append(o));var s=e.list||[],c=e.type||"list",l=e.onClick||_emptyFn,u=$('<ul class="'+("list"===c?"w-e-list":"w-e-block")+'"></ul>');i.append(u),s.forEach(function(t){var e=t.$elem,n=e.html();n=replaceLang(a,n),e.html(n);var i=t.value,o=$('<li class="w-e-item"></li>');e&&(o.append(e),u.append(o),o.on("click",function(t){l(i),r.hideTimeoutId=setTimeout(function(){r.hide()},0)}))}),i.on("mouseleave",function(t){r.hideTimeoutId=setTimeout(function(){r.hide()},0)}),this.$container=i,this._rendered=!1,this._show=!1}function Head(t){var e=this;this.editor=t,this.$elem=$('<div class="w-e-menu"><i class="w-e-icon-header"></i></div>'),this.type="droplist",this._active=!1,this.droplist=new DropList(this,{width:100,$title:$("<p>ËÆæÁΩÆÊ†áÈ¢ò</p>"),type:"list",list:[{$elem:$("<h1>H1</h1>"),value:"<h1>"},{$elem:$("<h2>H2</h2>"),value:"<h2>"},{$elem:$("<h3>H3</h3>"),value:"<h3>"},{$elem:$("<h4>H4</h4>"),value:"<h4>"},{$elem:$("<h5>H5</h5>"),value:"<h5>"},{$elem:$("<p>Ê≠£Êñá</p>"),value:"<p>"}],onClick:function(t){e._command(t)}})}function FontSize(t){var e=this;this.editor=t,this.$elem=$('<div class="w-e-menu"><i class="w-e-icon-text-heigh"></i></div>'),this.type="droplist",this._active=!1,this.droplist=new DropList(this,{width:160,$title:$("<p>Â≠óÂè∑</p>"),type:"list",list:[{$elem:$('<span style="font-size: x-small;">x-small</span>'),value:"1"},{$elem:$('<span style="font-size: small;">small</span>'),value:"2"},{$elem:$("<span>normal</span>"),value:"3"},{$elem:$('<span style="font-size: large;">large</span>'),value:"4"},{$elem:$('<span style="font-size: x-large;">x-large</span>'),value:"5"},{$elem:$('<span style="font-size: xx-large;">xx-large</span>'),value:"6"}],onClick:function(t){e._command(t)}})}function FontName(t){var e=this;this.editor=t,this.$elem=$('<div class="w-e-menu"><i class="w-e-icon-font"></i></div>'),this.type="droplist",this._active=!1;var n=t.config.fontNames||[];this.droplist=new DropList(this,{width:100,$title:$("<p>Â≠ó‰Ωì</p>"),type:"list",list:n.map(function(t){return{$elem:$('<span style="font-family: '.concat(t,';">').concat(t,"</span>")),value:t}}),onClick:function(t){e._command(t)}})}DropList.prototype={constructor:DropList,show:function(){this.hideTimeoutId&&clearTimeout(this.hideTimeoutId);var t=this.menu.$elem,e=this.$container;if(!this._show){if(this._rendered)e.show();else{var n=t.getSizeData().height||0,i=this.opt.width||100;e.css("margin-top",n+"px").css("width",i+"px"),t.append(e),this._rendered=!0}this._show=!0}},hide:function(){this.showTimeoutId&&clearTimeout(this.showTimeoutId);var t=this.$container;this._show&&(t.hide(),this._show=!1)}},Head.prototype={constructor:Head,_command:function(t){var e=this.editor,n=e.selection.getSelectionContainerElem();e.$textElem.equal(n)||e.cmd.do("formatBlock",t)},tryChangeActive:function(){var t=this.editor,e=this.$elem,n=t.cmd.queryCommandValue("formatBlock");/^h/i.test(n)?(this._active=!0,e.addClass("w-e-active")):(this._active=!1,e.removeClass("w-e-active"))}},FontSize.prototype={constructor:FontSize,_command:function(t){this.editor.cmd.do("fontSize",t)}},FontName.prototype={constructor:FontName,_command:function(t){this.editor.cmd.do("fontName",t)}};var emptyFn=function(){},_isCreatedPanelMenus=[];function Panel(t,e){this.menu=t,this.opt=e}function Link(t){this.editor=t,this.$elem=$('<div class="w-e-menu"><i class="w-e-icon-link"></i></div>'),this.type="panel",this._active=!1}Panel.prototype={constructor:Panel,show:function(){var r=this,t=this.menu;if(!(0<=_isCreatedPanelMenus.indexOf(t))){var a=t.editor,e=$("body"),n=a.$textContainerElem,i=this.opt,o=$('<div class="w-e-panel-container"></div>'),s=i.width||300;o.css("width",s+"px").css("margin-left",(0-s)/2+"px");var c=$('<i class="w-e-icon-close w-e-panel-close"></i>');o.append(c),c.on("click",function(){r.hide()});var l=$('<ul class="w-e-panel-tab-title"></ul>'),u=$('<div class="w-e-panel-tab-content"></div>');o.append(l).append(u);var d=i.height;d&&u.css("height",d+"px").css("overflow-y","auto");var h=i.tabs||[],m=[],f=[];h.forEach(function(t,e){if(t){var n=t.title||"",i=t.tpl||"";n=replaceLang(a,n),i=replaceLang(a,i);var o=$('<li class="w-e-item">'.concat(n,"</li>"));l.append(o);var r=$(i);u.append(r),o._index=e,m.push(o),f.push(r),0===e?(o._active=!0,o.addClass("w-e-active")):r.hide(),o.on("click",function(t){o._active||(m.forEach(function(t){t._active=!1,t.removeClass("w-e-active")}),f.forEach(function(t){t.hide()}),o._active=!0,o.addClass("w-e-active"),r.show())})}}),o.on("click",function(t){t.stopPropagation()}),e.on("click",function(t){r.hide()}),n.append(o),h.forEach(function(t,o){t&&(t.events||[]).forEach(function(t){var e=t.selector,n=t.type,i=t.fn||emptyFn;f[o].find(e).on(n,function(t){t.stopPropagation(),i(t)&&r.hide()})})});var p=o.find("input[type=text],textarea");p.length&&p.get(0).focus(),this.$container=o,this._hideOtherPanels(),_isCreatedPanelMenus.push(t)}},hide:function(){var e=this.menu,t=this.$container;t&&t.remove(),_isCreatedPanelMenus=_isCreatedPanelMenus.filter(function(t){return t!==e})},_hideOtherPanels:function(){_isCreatedPanelMenus.length&&_isCreatedPanelMenus.forEach(function(t){var e=t.panel||{};e.hide&&e.hide()})}};var alert=window.alert;function Italic(t){this.editor=t,this.$elem=$('<div class="w-e-menu">\n            <i class="w-e-icon-italic"></i>\n        </div>'),this.type="click",this._active=!1}function Redo(t){this.editor=t,this.$elem=$('<div class="w-e-menu">\n            <i class="w-e-icon-redo"></i>\n        </div>'),this.type="click",this._active=!1}function StrikeThrough(t){this.editor=t,this.$elem=$('<div class="w-e-menu">\n            <i class="w-e-icon-strikethrough"></i>\n        </div>'),this.type="click",this._active=!1}function Underline(t){this.editor=t,this.$elem=$('<div class="w-e-menu">\n            <i class="w-e-icon-underline"></i>\n        </div>'),this.type="click",this._active=!1}function Undo(t){this.editor=t,this.$elem=$('<div class="w-e-menu">\n            <i class="w-e-icon-undo"></i>\n        </div>'),this.type="click",this._active=!1}function List(t){var e=this;this.editor=t,this.$elem=$('<div class="w-e-menu"><i class="w-e-icon-list2"></i></div>'),this.type="droplist",this._active=!1,this.droplist=new DropList(this,{width:120,$title:$("<p>ËÆæÁΩÆÂàóË°®</p>"),type:"list",list:[{$elem:$('<span><i class="w-e-icon-list-numbered"></i> ÊúâÂ∫èÂàóË°®</span>'),value:"insertOrderedList"},{$elem:$('<span><i class="w-e-icon-list2"></i> Êó†Â∫èÂàóË°®</span>'),value:"insertUnorderedList"}],onClick:function(t){e._command(t)}})}function Justify(t){var e=this;this.editor=t,this.$elem=$('<div class="w-e-menu"><i class="w-e-icon-paragraph-left"></i></div>'),this.type="droplist",this._active=!1,this.droplist=new DropList(this,{width:100,$title:$("<p>ÂØπÈΩêÊñπÂºè</p>"),type:"list",list:[{$elem:$('<span><i class="w-e-icon-paragraph-left"></i> Èù†Â∑¶</span>'),value:"justifyLeft"},{$elem:$('<span><i class="w-e-icon-paragraph-center"></i> Â±Ö‰∏≠</span>'),value:"justifyCenter"},{$elem:$('<span><i class="w-e-icon-paragraph-right"></i> Èù†Âè≥</span>'),value:"justifyRight"}],onClick:function(t){e._command(t)}})}function ForeColor(t){var e=this;this.editor=t,this.$elem=$('<div class="w-e-menu"><i class="w-e-icon-pencil2"></i></div>'),this.type="droplist";var n=t.config.colors||[];this._active=!1,this.droplist=new DropList(this,{width:120,$title:$("<p>ÊñáÂ≠óÈ¢úËâ≤</p>"),type:"inline-block",list:n.map(function(t){return{$elem:$('<i style="color:'.concat(t,';" class="w-e-icon-pencil2"></i>')),value:t}}),onClick:function(t){e._command(t)}})}function BackColor(t){var e=this;this.editor=t,this.$elem=$('<div class="w-e-menu"><i class="w-e-icon-paint-brush"></i></div>'),this.type="droplist";var n=t.config.colors||[];this._active=!1,this.droplist=new DropList(this,{width:120,$title:$("<p>ËÉåÊôØËâ≤</p>"),type:"inline-block",list:n.map(function(t){return{$elem:$('<i style="color:'.concat(t,';" class="w-e-icon-paint-brush"></i>')),value:t}}),onClick:function(t){e._command(t)}})}function Quote(t){this.editor=t,this.$elem=$('<div class="w-e-menu">\n            <i class="w-e-icon-quotes-left"></i>\n        </div>'),this.type="click",this._active=!1}function Code(t){this.editor=t,this.$elem=$('<div class="w-e-menu">\n            <i class="w-e-icon-terminal"></i>\n        </div>'),this.type="panel",this._active=!1}function Emoticon(t){this.editor=t,this.$elem=$('<div class="w-e-menu">\n            <i class="w-e-icon-happy"></i>\n        </div>'),this.type="panel",this._active=!1}function Table(t){this.editor=t,this.$elem=$('<div class="w-e-menu"><i class="w-e-icon-table2"></i></div>'),this.type="panel",this._active=!1}function Video(t){this.editor=t,this.$elem=$('<div class="w-e-menu"><i class="w-e-icon-play"></i></div>'),this.type="panel",this._active=!1}function Image(t){this.editor=t;var e=getRandom("w-e-img");this.$elem=$('<div class="w-e-menu" id="'+e+'"><i class="w-e-icon-image"></i></div>'),t.imgMenuId=e,this.type="panel",this._active=!1}Link.prototype={constructor:Link,onClick:function(){var t,e=this.editor;if(this._active){if(!(t=e.selection.getSelectionContainerElem()))return;e.selection.createRangeByElem(t),e.selection.restoreSelection(),this._createPanel(t.text(),t.attr("href"))}else e.selection.isSelectionEmpty()?this._createPanel("",""):this._createPanel(e.selection.getSelectionText(),"")},_createPanel:function(t,e){var o=this,r=getRandom("input-link"),a=getRandom("input-text"),n=getRandom("btn-ok"),i=getRandom("btn-del"),s=this._active?"inline-block":"none",c=new Panel(this,{width:300,tabs:[{title:"ÈìæÊé•",tpl:'<div>\n                    <input id="'.concat(a,'" type="text" class="block" value="').concat(t,'" placeholder="ÈìæÊé•ÊñáÂ≠ó"/></td>\n                    <input id="').concat(r,'" type="text" class="block" value="').concat(e,'" placeholder="http://..."/></td>\n                    <div class="w-e-button-container">\n                        <button id="').concat(n,'" class="right">ÊèíÂÖ•</button>\n                        <button id="').concat(i,'" class="gray right" style="display:').concat(s,'">Âà†Èô§ÈìæÊé•</button>\n                    </div>\n                </div>'),events:[{selector:"#"+n,type:"click",fn:function(){var t=$("#"+r),e=$("#"+a),n=t.val(),i=e.val();return o._insertLink(i,n),!0}},{selector:"#"+i,type:"click",fn:function(){return o._delLink(),!0}}]}]});c.show(),this.panel=c},_delLink:function(){if(this._active){var t=this.editor;if(t.selection.getSelectionContainerElem()){var e=t.selection.getSelectionText();t.cmd.do("insertHTML","<span>"+e+"</span>")}}},_insertLink:function(t,e){var n=this.editor,i=n.config.linkCheck,o=!0;i&&"function"==typeof i&&(o=i(t,e)),!0===o?n.cmd.do("insertHTML",'<a href="'.concat(e,'" target="_blank">').concat(t,"</a>")):alert(o)},tryChangeActive:function(){var t=this.editor,e=this.$elem,n=t.selection.getSelectionContainerElem();n&&("A"===n.getNodeName()?(this._active=!0,e.addClass("w-e-active")):(this._active=!1,e.removeClass("w-e-active")))}},Italic.prototype={constructor:Italic,onClick:function(){var t=this.editor,e=t.selection.isSelectionEmpty();e&&t.selection.createEmptyRange(),t.cmd.do("italic"),e&&(t.selection.collapseRange(),t.selection.restoreSelection())},tryChangeActive:function(){var t=this.editor,e=this.$elem;t.cmd.queryCommandState("italic")?(this._active=!0,e.addClass("w-e-active")):(this._active=!1,e.removeClass("w-e-active"))}},Redo.prototype={constructor:Redo,onClick:function(){this.editor.cmd.do("redo")}},StrikeThrough.prototype={constructor:StrikeThrough,onClick:function(){var t=this.editor,e=t.selection.isSelectionEmpty();e&&t.selection.createEmptyRange(),t.cmd.do("strikeThrough"),e&&(t.selection.collapseRange(),t.selection.restoreSelection())},tryChangeActive:function(){var t=this.editor,e=this.$elem;t.cmd.queryCommandState("strikeThrough")?(this._active=!0,e.addClass("w-e-active")):(this._active=!1,e.removeClass("w-e-active"))}},Underline.prototype={constructor:Underline,onClick:function(){var t=this.editor,e=t.selection.isSelectionEmpty();e&&t.selection.createEmptyRange(),t.cmd.do("underline"),e&&(t.selection.collapseRange(),t.selection.restoreSelection())},tryChangeActive:function(){var t=this.editor,e=this.$elem;t.cmd.queryCommandState("underline")?(this._active=!0,e.addClass("w-e-active")):(this._active=!1,e.removeClass("w-e-active"))}},Undo.prototype={constructor:Undo,onClick:function(){this.editor.cmd.do("undo")}},List.prototype={constructor:List,_command:function(t){var e=this.editor,n=e.$textElem;if(e.selection.restoreSelection(),!e.cmd.queryCommandState(t)){e.cmd.do(t);var i=e.selection.getSelectionContainerElem();if("LI"===i.getNodeName()&&(i=i.parent()),!1!==/^ol|ul$/i.test(i.getNodeName())&&!i.equal(n)){var o=i.parent();o.equal(n)||(i.insertAfter(o),o.remove())}}},tryChangeActive:function(){var t=this.editor,e=this.$elem;t.cmd.queryCommandState("insertUnOrderedList")||t.cmd.queryCommandState("insertOrderedList")?(this._active=!0,e.addClass("w-e-active")):(this._active=!1,e.removeClass("w-e-active"))}},Justify.prototype={constructor:Justify,_command:function(t){this.editor.cmd.do(t)}},ForeColor.prototype={constructor:ForeColor,_command:function(t){this.editor.cmd.do("foreColor",t)}},BackColor.prototype={constructor:BackColor,_command:function(t){this.editor.cmd.do("backColor",t)}},Quote.prototype={constructor:Quote,onClick:function(){var t,e=this.editor,n=e.selection.getSelectionContainerElem(),i=n.getNodeName();if(UA.isIE())return"P"===i?(t=n.text(),$("<blockquote>".concat(t,"</blockquote>")).insertAfter(n),void n.remove()):void("BLOCKQUOTE"===i&&(t=n.text(),$("<p>".concat(t,"</p>")).insertAfter(n),n.remove()));"BLOCKQUOTE"===i?e.cmd.do("formatBlock","<P>"):e.cmd.do("formatBlock","<BLOCKQUOTE>")},tryChangeActive:function(){var t=this.editor,e=this.$elem,n=t.cmd.queryCommandValue("formatBlock");/^BLOCKQUOTE$/i.test(n)?(this._active=!0,e.addClass("w-e-active")):(this._active=!1,e.removeClass("w-e-active"))}},Code.prototype={constructor:Code,onClick:function(){var t,e=this.editor,n=e.selection.getSelectionStartElem(),i=e.selection.getSelectionEndElem(),o=e.selection.isSelectionEmpty(),r=e.selection.getSelectionText();if(n.equal(i))return o?void(this._active?this._createPanel(n.html()):this._createPanel()):(t=$("<code>".concat(r,"</code>")),e.cmd.do("insertElem",t),e.selection.createRangeByElem(t,!1),void e.selection.restoreSelection());e.selection.restoreSelection()},_createPanel:function(t){var n=this,i=(t=t||"")?"edit":"new",o=getRandom("texxt"),e=getRandom("btn"),r=new Panel(this,{width:500,tabs:[{title:"ÊèíÂÖ•‰ª£Á†Å",tpl:'<div>\n                        <textarea id="'.concat(o,'" style="height:145px;;">').concat(t,'</textarea>\n                        <div class="w-e-button-container">\n                            <button id="').concat(e,'" class="right">ÊèíÂÖ•</button>\n                        </div>\n                    <div>'),events:[{selector:"#"+e,type:"click",fn:function(){var t=$("#"+o),e=t.val()||t.html();return e=replaceHtmlSymbol(e),"new"==i?n._insertCode(e):n._updateCode(e),!0}}]}]});r.show(),this.panel=r},_insertCode:function(t){this.editor.cmd.do("insertHTML","<pre><code>".concat(t,"</code></pre><p><br></p>"))},_updateCode:function(t){var e=this.editor,n=e.selection.getSelectionContainerElem();n&&(n.html(t),e.selection.restoreSelection())},tryChangeActive:function(){var t=this.editor,e=this.$elem,n=t.selection.getSelectionContainerElem();if(n){var i=n.parent();"CODE"===n.getNodeName()&&"PRE"===i.getNodeName()?(this._active=!0,e.addClass("w-e-active")):(this._active=!1,e.removeClass("w-e-active"))}}},Emoticon.prototype={constructor:Emoticon,onClick:function(){this._createPanel()},_createPanel:function(){var o=this,t=this.editor.config.emotions||[],r=[];t.forEach(function(t){var e=t.type,n=t.content||[],i="";"emoji"===e&&n.forEach(function(t){t&&(i+='<span class="w-e-item">'+t+"</span>")}),"image"===e&&n.forEach(function(t){var e=t.src,n=t.alt;e&&(i+='<span class="w-e-item"><img src="'+e+'" alt="'+n+'" data-w-e="1"/></span>')}),r.push({title:t.title,tpl:'<div class="w-e-emoticon-container">'.concat(i,"</div>"),events:[{selector:"span.w-e-item",type:"click",fn:function(t){var e,n=$(t.target);return e="IMG"===n.getNodeName()?n.parent().html():"<span>"+n.html()+"</span>",o._insert(e),!0}}]})});var e=new Panel(this,{width:300,height:200,tabs:r});e.show(),this.panel=e},_insert:function(t){this.editor.cmd.do("insertHTML",t)}},Table.prototype={constructor:Table,onClick:function(){this._active?this._createEditPanel():this._createInsertPanel()},_createInsertPanel:function(){var n=this,t=getRandom("btn"),i=getRandom("row"),o=getRandom("col"),e=new Panel(this,{width:250,tabs:[{title:"ÊèíÂÖ•Ë°®Ê†º",tpl:'<div>\n                        <p style="text-align:left; padding:5px 0;">\n                            ÂàõÂª∫\n                            <input id="'.concat(i,'" type="text" value="5" style="width:40px;text-align:center;"/>\n                            Ë°å\n                            <input id="').concat(o,'" type="text" value="5" style="width:40px;text-align:center;"/>\n                            ÂàóÁöÑË°®Ê†º\n                        </p>\n                        <div class="w-e-button-container">\n                            <button id="').concat(t,'" class="right">ÊèíÂÖ•</button>\n                        </div>\n                    </div>'),events:[{selector:"#"+t,type:"click",fn:function(){var t=parseInt($("#"+i).val()),e=parseInt($("#"+o).val());return t&&e&&0<t&&0<e&&n._insert(t,e),!0}}]}]});e.show(),this.panel=e},_insert:function(t,e){var n,i,o='<table border="0" width="100%" cellpadding="0" cellspacing="0">';for(n=0;n<t;n++){if(o+="<tr>",0===n)for(i=0;i<e;i++)o+="<th>&nbsp;</th>";else for(i=0;i<e;i++)o+="<td>&nbsp;</td>";o+="</tr>"}o+="</table><p><br></p>";var r=this.editor;r.cmd.do("insertHTML",o),r.cmd.do("enableObjectResizing",!1),r.cmd.do("enableInlineTableEditing",!1)},_createEditPanel:function(){var t=this,e=getRandom("add-row"),n=getRandom("add-col"),i=getRandom("del-row"),o=getRandom("del-col"),r=getRandom("del-table");new Panel(this,{width:320,tabs:[{title:"ÁºñËæëË°®Ê†º",tpl:'<div>\n                        <div class="w-e-button-container" style="border-bottom:1px solid #f1f1f1;padding-bottom:5px;margin-bottom:5px;">\n                            <button id="'.concat(e,'" class="left">Â¢ûÂä†Ë°å</button>\n                            <button id="').concat(i,'" class="red left">Âà†Èô§Ë°å</button>\n                            <button id="').concat(n,'" class="left">Â¢ûÂä†Âàó</button>\n                            <button id="').concat(o,'" class="red left">Âà†Èô§Âàó</button>\n                        </div>\n                        <div class="w-e-button-container">\n                            <button id="').concat(r,'" class="gray left">Âà†Èô§Ë°®Ê†º</button>\n                        </dv>\n                    </div>'),events:[{selector:"#"+e,type:"click",fn:function(){return t._addRow(),!0}},{selector:"#"+n,type:"click",fn:function(){return t._addCol(),!0}},{selector:"#"+i,type:"click",fn:function(){return t._delRow(),!0}},{selector:"#"+o,type:"click",fn:function(){return t._delCol(),!0}},{selector:"#"+r,type:"click",fn:function(){return t._delTable(),!0}}]}]}).show()},_getLocationData:function(){var n={},i=this.editor.selection.getSelectionContainerElem();if(i){var t=i.getNodeName();if("TD"===t||"TH"===t){var o=i.parent(),e=o.children(),r=e.length;e.forEach(function(t,e){if(t===i[0])return!(n.td={index:e,elem:t,length:r})});var a=o.parent().children(),s=a.length;return a.forEach(function(t,e){if(t===o[0])return!(n.tr={index:e,elem:t,length:s})}),n}}},_addRow:function(){var t=this._getLocationData();if(t){var e,n=$(t.tr.elem),i=t.td.length,o=document.createElement("tr"),r="";for(e=0;e<i;e++)r+="<td>&nbsp;</td>";o.innerHTML=r,$(o).insertAfter(n)}},_addCol:function(){var t=this._getLocationData();if(t){var e=t.tr,i=t.td.index;$(e.elem).parent().children().forEach(function(t){var e=$(t).children().get(i),n=e.getNodeName().toLowerCase();$(document.createElement(n)).insertAfter(e)})}},_delRow:function(){var t=this._getLocationData();t&&$(t.tr.elem).remove()},_delCol:function(){var t=this._getLocationData();if(t){var e=t.tr,n=t.td.index;$(e.elem).parent().children().forEach(function(t){$(t).children().get(n).remove()})}},_delTable:function(){var t=this.editor.selection.getSelectionContainerElem();if(t){var e=t.parentUntil("table");e&&e.remove()}},tryChangeActive:function(){var t=this.editor,e=this.$elem,n=t.selection.getSelectionContainerElem();if(n){var i=n.getNodeName();"TD"===i||"TH"===i?(this._active=!0,e.addClass("w-e-active")):(this._active=!1,e.removeClass("w-e-active"))}}},Video.prototype={constructor:Video,onClick:function(){this._createPanel()},_createPanel:function(){var e=this,n=getRandom("text-val"),t=getRandom("btn"),i=new Panel(this,{width:350,tabs:[{title:"ÊèíÂÖ•ËßÜÈ¢ë",tpl:'<div>\n                    <input id="'.concat(n,'" type="text" class="block" placeholder="Ê†ºÂºèÂ¶ÇÔºö<iframe src=... ></iframe>"/>\n                    <div class="w-e-button-container">\n                        <button id="').concat(t,'" class="right">ÊèíÂÖ•</button>\n                    </div>\n                </div>'),events:[{selector:"#"+t,type:"click",fn:function(){var t=$("#"+n).val().trim();return t&&e._insert(t),!0}}]}]});i.show(),this.panel=i},_insert:function(t){this.editor.cmd.do("insertHTML",t+"<p><br></p>")}},Image.prototype={constructor:Image,onClick:function(){this.editor.config.qiniu||(this._active?this._createEditPanel():this._createInsertPanel())},_createEditPanel:function(){var e=this.editor,t=getRandom("width-30"),n=getRandom("width-50"),i=getRandom("width-100"),o=getRandom("del-btn"),r=new Panel(this,{width:300,tabs:[{title:"ÁºñËæëÂõæÁâá",tpl:'<div>\n                <div class="w-e-button-container" style="border-bottom:1px solid #f1f1f1;padding-bottom:5px;margin-bottom:5px;">\n                    <span style="float:left;font-size:14px;margin:4px 5px 0 5px;color:#333;">ÊúÄÂ§ßÂÆΩÂ∫¶Ôºö</span>\n                    <button id="'.concat(t,'" class="left">30%</button>\n                    <button id="').concat(n,'" class="left">50%</button>\n                    <button id="').concat(i,'" class="left">100%</button>\n                </div>\n                <div class="w-e-button-container">\n                    <button id="').concat(o,'" class="gray left">Âà†Èô§ÂõæÁâá</button>\n                </dv>\n            </div>'),events:[{selector:"#"+t,type:"click",fn:function(){var t=e._selectedImg;return t&&t.css("max-width","30%"),!0}},{selector:"#"+n,type:"click",fn:function(){var t=e._selectedImg;return t&&t.css("max-width","50%"),!0}},{selector:"#"+i,type:"click",fn:function(){var t=e._selectedImg;return t&&t.css("max-width","100%"),!0}},{selector:"#"+o,type:"click",fn:function(){var t=e._selectedImg;return t&&t.remove(),!0}}]}]});r.show(),this.panel=r},_createInsertPanel:function(){var t=this.editor,n=t.uploadImg,e=t.config,i=getRandom("up-trigger"),o=getRandom("up-file"),r=getRandom("link-url"),a=getRandom("link-btn"),s=[{title:"‰∏ä‰º†ÂõæÁâá",tpl:'<div class="w-e-up-img-container">\n                    <div id="'.concat(i,'" class="w-e-up-btn">\n                        <i class="w-e-icon-upload2"></i>\n                    </div>\n                    <div style="display:none;">\n                        <input id="').concat(o,'" type="file" multiple="multiple" accept="image/jpg,image/jpeg,image/png,image/gif,image/bmp"/>\n                    </div>\n                </div>'),events:[{selector:"#"+i,type:"click",fn:function(){var t=$("#"+o)[0];if(!t)return!0;t.click()}},{selector:"#"+o,type:"change",fn:function(){var t=$("#"+o)[0];if(!t)return!0;var e=t.files;return e.length&&n.uploadImg(e),!0}}]},{title:"ÁΩëÁªúÂõæÁâá",tpl:'<div>\n                    <input id="'.concat(r,'" type="text" class="block" placeholder="ÂõæÁâáÈìæÊé•"/></td>\n                    <div class="w-e-button-container">\n                        <button id="').concat(a,'" class="right">ÊèíÂÖ•</button>\n                    </div>\n                </div>'),events:[{selector:"#"+a,type:"click",fn:function(){var t=$("#"+r).val().trim();return t&&n.insertLinkImg(t),!0}}]}],c=[];(e.uploadImgShowBase64||e.uploadImgServer||e.customUploadImg)&&window.FileReader&&c.push(s[0]),e.showLinkImg&&c.push(s[1]);var l=new Panel(this,{width:300,tabs:c});l.show(),this.panel=l},tryChangeActive:function(){var t=this.editor,e=this.$elem;t._selectedImg?(this._active=!0,e.addClass("w-e-active")):(this._active=!1,e.removeClass("w-e-active"))}};var MenuConstructors={};function Menus(t){this.editor=t,this.menus={}}function getPasteText(t){var e=t.clipboardData||t.originalEvent&&t.originalEvent.clipboardData;return replaceHtmlSymbol(null==e?window.clipboardData&&window.clipboardData.getData("text"):e.getData("text/plain"))}function getPasteHtml(t,e,n){var i,o,r=t.clipboardData||t.originalEvent&&t.originalEvent.clipboardData;if(null==r?i=window.clipboardData&&window.clipboardData.getData("text"):(i=r.getData("text/plain"),o=r.getData("text/html")),!o&&i&&(o="<p>"+replaceHtmlSymbol(i)+"</p>"),o){var a=o.split("</html>");return 2===a.length&&(o=a[0]),o=(o=(o=o.replace(/<(meta|script|link).+?>/gim,"")).replace(/<!--.*?-->/gm,"")).replace(/\s?data-.+?=('|").+?('|")/gim,""),n&&(o=o.replace(/<img.+?>/gim,"")),o=e?o.replace(/\s?(class|style)=('|").*?('|")/gim,""):o.replace(/\s?class=('|").*?('|")/gim,"")}}function getPasteImgs(t){var i=[];if(getPasteText(t))return i;var e=(t.clipboardData||t.originalEvent&&t.originalEvent.clipboardData||{}).items;return e&&objForEach(e,function(t,e){var n=e.type;/image/i.test(n)&&i.push(e.getAsFile())}),i}function getChildrenJSON(t){var c=[];return(t.childNodes()||[]).forEach(function(t){var e,n=t.nodeType;if(3===n&&(e=replaceHtmlSymbol(e=t.textContent)),1===n){(e={}).tag=t.nodeName.toLowerCase();for(var i=[],o=t.attributes||{},r=o.length||0,a=0;a<r;a++){var s=o[a];i.push({name:s.name,value:s.value})}e.attrs=i,e.children=getChildrenJSON($(t))}c.push(e)}),c}function Text(t){this.editor=t}function Command(t){this.editor=t}function API(t){this.editor=t,this._currentRange=null}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Progress(t){this.editor=t,this._time=0,this._isShow=!1,this._isRender=!1,this._timeoutId=0,this.$textContainer=t.$textContainerElem,this.$bar=$('<div class="w-e-progress"></div>')}function UploadImg(t){this.editor=t}MenuConstructors.bold=Bold,MenuConstructors.head=Head,MenuConstructors.fontSize=FontSize,MenuConstructors.fontName=FontName,MenuConstructors.link=Link,MenuConstructors.italic=Italic,MenuConstructors.redo=Redo,MenuConstructors.strikeThrough=StrikeThrough,MenuConstructors.underline=Underline,MenuConstructors.undo=Undo,MenuConstructors.list=List,MenuConstructors.justify=Justify,MenuConstructors.foreColor=ForeColor,MenuConstructors.backColor=BackColor,MenuConstructors.quote=Quote,MenuConstructors.code=Code,MenuConstructors.emoticon=Emoticon,MenuConstructors.table=Table,MenuConstructors.video=Video,MenuConstructors.image=Image,Menus.prototype={constructor:Menus,init:function(){var n=this,i=this.editor;((i.config||{}).menus||[]).forEach(function(t){var e=MenuConstructors[t];e&&"function"==typeof e&&(n.menus[t]=new e(i))}),this._addToToolbar(),this._bindEvent()},_addToToolbar:function(){var t=this.editor,i=t.$toolbarElem,e=this.menus,o=t.config.zIndex+1;objForEach(e,function(t,e){var n=e.$elem;n&&(n.css("z-index",o),i.append(n))})},_bindEvent:function(){var t=this.menus,r=this.editor;objForEach(t,function(t,e){var n=e.type;if(n){var i=e.$elem,o=e.droplist;"click"===n&&e.onClick&&i.on("click",function(t){null!=r.selection.getRange()&&e.onClick(t)}),"droplist"===n&&o&&i.on("mouseenter",function(t){null!=r.selection.getRange()&&(o.showTimeoutId=setTimeout(function(){o.show()},200))}).on("mouseleave",function(t){o.hideTimeoutId=setTimeout(function(){o.hide()},0)}),"panel"===n&&e.onClick&&i.on("click",function(t){t.stopPropagation(),null!=r.selection.getRange()&&e.onClick(t)})}})},changeActive:function(){objForEach(this.menus,function(t,e){e.tryChangeActive&&setTimeout(function(){e.tryChangeActive()},100)})}},Text.prototype={constructor:Text,init:function(){this._bindEvent()},clear:function(){this.html("<p><br></p>")},html:function(t){var e,n=this.editor,i=n.$textElem;if(null==t)return e=i.html(),e=e.replace(/\u200b/gm,""),e;i.html(t),n.initSelection()},getJSON:function(){return getChildrenJSON(this.editor.$textElem)},text:function(t){var e,n=this.editor,i=n.$textElem;if(null==t)return e=i.text(),e=e.replace(/\u200b/gm,""),e;i.text("<p>".concat(t,"</p>")),n.initSelection()},append:function(t){var e=this.editor;e.$textElem.append($(t)),e.initSelection()},_bindEvent:function(){this._saveRangeRealTime(),this._enterKeyHandle(),this._clearHandle(),this._pasteHandle(),this._tabHandle(),this._imgHandle(),this._dragHandle()},_saveRangeRealTime:function(){var e=this.editor,n=e.$textElem;function i(t){e.selection.saveRange(),e.menus.changeActive()}n.on("keyup",i),n.on("mousedown",function(t){n.on("mouseleave",i)}),n.on("mouseup",function(t){i(),n.off("mouseleave",i)})},_enterKeyHandle:function(){var c=this.editor,i=c.$textElem;function o(t){var e=$("<p><br></p>");e.insertBefore(t),c.selection.createRangeByElem(e,!0),c.selection.restoreSelection(),t.remove()}i.on("keyup",function(t){var e,n;13===t.keyCode&&(e=c.selection.getSelectionContainerElem(),"<code><br></code>"!==(n=e.parent()).html()?n.equal(i)&&"P"!==e.getNodeName()&&(e.text()||o(e)):o(e))}),i.on("keydown",function(t){13===t.keyCode?function(t){var e=c.selection.getSelectionContainerElem();if(e){var n=e.parent(),i=e.getNodeName(),o=n.getNodeName();if("CODE"===i&&"PRE"===o&&c.cmd.queryCommandSupported("insertHTML")){if(!0===c._willBreakCode){var r=$("<p><br></p>");return r.insertAfter(n),c.selection.createRangeByElem(r,!0),c.selection.restoreSelection(),c._willBreakCode=!1,t.preventDefault()}var a=c.selection.getRange().startOffset;c.cmd.do("insertHTML","\n"),c.selection.saveRange(),c.selection.getRange().startOffset===a&&c.cmd.do("insertHTML","\n");var s=e.html().length;c.selection.getRange().startOffset+1===s&&(c._willBreakCode=!0),t.preventDefault()}}}(t):c._willBreakCode=!1})},_clearHandle:function(){var i=this.editor,o=i.$textElem;o.on("keydown",function(t){8===t.keyCode&&"<p><br></p>"===o.html().toLowerCase().trim()&&t.preventDefault()}),o.on("keyup",function(t){if(8===t.keyCode){var e,n=o.html().toLowerCase().trim();n&&"<br>"!==n||(e=$("<p><br/></p>"),o.html(""),o.append(e),i.selection.createRangeByElem(e,!1,!0),i.selection.restoreSelection())}})},_pasteHandle:function(){var r=this.editor,t=r.config,a=t.pasteFilterStyle,s=t.pasteTextHandle,c=t.pasteIgnoreImg,e=r.$textElem,l=0;function u(){var t=Date.now(),e=!1;return 100<=t-l&&(e=!0),l=t,e}e.on("paste",function(t){if(!UA.isIE()&&(t.preventDefault(),u())){var e=getPasteHtml(t,a,c),n=getPasteText(t);n=n.replace(/\n/gm,"<br>");var i=r.selection.getSelectionContainerElem();if(i){var o=i.getNodeName();if("CODE"===o||"PRE"===o)return s&&isFunction(s)&&(n=""+(s(n)||"")),void r.cmd.do("insertHTML","<p>".concat(n,"</p>"));if(e)try{s&&isFunction(s)&&(e=""+(s(e)||"")),r.cmd.do("insertHTML",e)}catch(t){s&&isFunction(s)&&(n=""+(s(n)||"")),r.cmd.do("insertHTML","<p>".concat(n,"</p>"))}else l=0}}}),e.on("paste",function(t){if(!UA.isIE()&&(t.preventDefault(),u())){var e=getPasteImgs(t);if(e&&e.length){var n=r.selection.getSelectionContainerElem();if(n){var i=n.getNodeName();if("CODE"!==i&&"PRE"!==i)r.uploadImg.uploadImg(e)}}}})},_tabHandle:function(){var r=this.editor;r.$textElem.on("keydown",function(t){if(9===t.keyCode&&r.cmd.queryCommandSupported("insertHTML")){var e=r.selection.getSelectionContainerElem();if(e){var n=e.parent(),i=e.getNodeName(),o=n.getNodeName();"CODE"===i&&"PRE"===o?r.cmd.do("insertHTML","    "):r.cmd.do("insertHTML","&nbsp;&nbsp;&nbsp;&nbsp;"),t.preventDefault()}}})},_imgHandle:function(){var n=this.editor,t=n.$textElem;t.on("click","img",function(t){var e=$(this);"1"!==e.attr("data-w-e")&&(n._selectedImg=e,n.selection.createRangeByElem(e),n.selection.restoreSelection())}),t.on("click  keyup",function(t){t.target.matches("img")||(n._selectedImg=null)})},_dragHandle:function(){var n=this.editor;$(document).on("dragleave drop dragenter dragover",function(t){t.preventDefault()}),n.$textElem.on("drop",function(t){t.preventDefault();var e=t.dataTransfer&&t.dataTransfer.files;e&&e.length&&n.uploadImg.uploadImg(e)})}},Command.prototype={constructor:Command,do:function(t,e){var n=this.editor;if(n._useStyleWithCSS||(document.execCommand("styleWithCSS",null,!0),n._useStyleWithCSS=!0),n.selection.getRange()){n.selection.restoreSelection();var i="_"+t;this[i]?this[i](e):this._execCommand(t,e),n.menus.changeActive(),n.selection.saveRange(),n.selection.restoreSelection(),n.change&&n.change()}},_insertHTML:function(t){var e=this.editor.selection.getRange();this.queryCommandSupported("insertHTML")?this._execCommand("insertHTML",t):e.insertNode?(e.deleteContents(),e.insertNode($(t)[0])):e.pasteHTML&&e.pasteHTML(t)},_insertElem:function(t){var e=this.editor.selection.getRange();e.insertNode&&(e.deleteContents(),e.insertNode(t[0]))},_execCommand:function(t,e){document.execCommand(t,!1,e)},queryCommandValue:function(t){return document.queryCommandValue(t)},queryCommandState:function(t){return document.queryCommandState(t)},queryCommandSupported:function(t){return document.queryCommandSupported(t)}},API.prototype={constructor:API,getRange:function(){return this._currentRange},saveRange:function(t){if(t)this._currentRange=t;else{var e=window.getSelection();if(0!==e.rangeCount){var n=e.getRangeAt(0),i=this.getSelectionContainerElem(n);if(i)if("false"!==i.attr("contenteditable")&&!i.parentUntil("[contenteditable=false]"))this.editor.$textElem.isContain(i)&&(this._currentRange=n)}}},collapseRange:function(t){null==t&&(t=!1);var e=this._currentRange;e&&e.collapse(t)},getSelectionText:function(){var t=this._currentRange,e=document.querySelector("#".concat(this.editor.textElemId));return t&&-1===e.innerHTML.indexOf("img")?this._currentRange.toString():-1<e.innerHTML.indexOf("img")?e.innerHTML.match(/<img.*?(?:>|\/>)/gi)[0].replace(/"/g,"&quot;").replace(/>/g,"&gt;"):""},getSelectionContainerElem:function(t){var e;if(t=t||this._currentRange)return $(1===(e=t.commonAncestorContainer).nodeType?e:e.parentNode)},getSelectionStartElem:function(t){var e;if(t=t||this._currentRange)return $(1===(e=t.startContainer).nodeType?e:e.parentNode)},getSelectionEndElem:function(t){var e;if(t=t||this._currentRange)return $(1===(e=t.endContainer).nodeType?e:e.parentNode)},isSelectionEmpty:function(){var t=this._currentRange;return!(!t||!t.startContainer||t.startContainer!==t.endContainer||t.startOffset!==t.endOffset)},restoreSelection:function(){var t=window.getSelection();t.removeAllRanges(),t.addRange(this._currentRange)},createEmptyRange:function(){var t,e=this.editor,n=this.getRange();if(n&&this.isSelectionEmpty())try{UA.isWebkit()?(e.cmd.do("insertHTML","&#8203;"),n.setEnd(n.endContainer,n.endOffset+1),this.saveRange(n)):(t=$("<strong>&#8203;</strong>"),e.cmd.do("insertElem",t),this.createRangeByElem(t,!0))}catch(t){}},createRangeByElem:function(t,e,n){if(t.length){var i=t[0],o=document.createRange();n?o.selectNodeContents(i):o.selectNode(i),"boolean"==typeof e&&o.collapse(e),this.saveRange(o)}}},Progress.prototype={constructor:Progress,show:function(t){var e=this;if(!this._isShow){this._isShow=!0;var n=this.$bar;if(this._isRender)this._isRender=!0;else this.$textContainer.append(n);100<Date.now()-this._time&&t<=1&&(n.css("width",100*t+"%"),this._time=Date.now());var i=this._timeoutId;i&&clearTimeout(i),i=setTimeout(function(){e._hide()},500)}},_hide:function(){this.$bar.remove(),this._time=0,this._isShow=!1,this._isRender=!1}};var alert$1=window.alert;UploadImg.prototype={constructor:UploadImg,_alert:function(t,e){var n=this.editor,i=n.config.debug,o=n.config.customAlert;if(i)throw new Error("wangEditor: "+(e||t));o&&"function"==typeof o?o(t):alert$1(t)},insertLinkImg:function(e){var t=this;if(e){var n,i=this.editor,o=i.config,r=o.linkImgCheck;if(r&&"function"==typeof r&&"string"==typeof(n=r(e)))alert$1(n);else{i.cmd.do("insertHTML",'<img src="'.concat(e,'" style="max-width:100%;"/>'));var a=document.createElement("img");a.onload=function(){var t=o.linkImgCallback;t&&"function"==typeof t&&t(e),a=null},a.onerror=function(){a=null,t._alert("ÊèíÂÖ•ÂõæÁâáÈîôËØØ",'wangEditor: ÊèíÂÖ•ÂõæÁâáÂá∫ÈîôÔºåÂõæÁâáÈìæÊé•ÊòØ "'.concat(e,'"Ôºå‰∏ãËΩΩËØ•ÈìæÊé•Â§±Ë¥•'))},a.onabort=function(){a=null},a.src=e}}},uploadImg:function(t){var i=this;if(t&&t.length){var o=this.editor,e=o.config,n=e.uploadImgServer,r=e.uploadImgShowBase64,a=e.uploadImgMaxSize,s=a/1024/1024,c=e.uploadImgMaxLength||1e4,l=e.uploadFileName||"",u=e.uploadImgParams||{},d=e.uploadImgParamsWithUrl,h=e.uploadImgHeaders||{},m=e.uploadImgHooks||{},f=e.uploadImgTimeout||3e3,p=e.withCredentials;null==p&&(p=!1);var v=e.customUploadImg;if(v||n||r){var g=[],y=[];if(arrForEach(t,function(t){var e=t.name,n=t.size;e&&n&&(!1!==/\.(jpg|jpeg|png|bmp|gif|webp)$/i.test(e)?a<n?y.push("„Äê".concat(e,"„ÄëÂ§ß‰∫é ").concat(s,"M")):g.push(t):y.push("„Äê".concat(e,"„Äë‰∏çÊòØÂõæÁâá")))}),y.length)this._alert("ÂõæÁâáÈ™åËØÅÊú™ÈÄöËøá: \n"+y.join("\n"));else if(g.length>c)this._alert("‰∏ÄÊ¨°ÊúÄÂ§ö‰∏ä‰º†"+c+"Âº†ÂõæÁâá");else if(v&&"function"==typeof v)v(g,this.insertLinkImg.bind(this));else{var w=new FormData;if(arrForEach(g,function(t){var e=l||t.name;w.append(e,t)}),n&&"string"==typeof n){var _=n.split("#");n=_[0];var C=_[1]||"";objForEach(u,function(t,e){d&&(0<n.indexOf("?")?n+="&":n+="?",n=n+t+"="+e),w.append(t,e)}),C&&(n+="#"+C);var b=new XMLHttpRequest;if(b.open("POST",n),b.timeout=f,b.ontimeout=function(){m.timeout&&"function"==typeof m.timeout&&m.timeout(b,o),i._alert("‰∏ä‰º†ÂõæÁâáË∂ÖÊó∂")},b.upload&&(b.upload.onprogress=function(t){var e,n=new Progress(o);t.lengthComputable&&(e=t.loaded/t.total,n.show(e))}),b.onreadystatechange=function(){var e;if(4===b.readyState){if(b.status<200||300<=b.status)return m.error&&"function"==typeof m.error&&m.error(b,o),void i._alert("‰∏ä‰º†ÂõæÁâáÂèëÁîüÈîôËØØ","‰∏ä‰º†ÂõæÁâáÂèëÁîüÈîôËØØÔºåÊúçÂä°Âô®ËøîÂõûÁä∂ÊÄÅÊòØ ".concat(b.status));if("object"!==_typeof(e=b.responseText))try{e=JSON.parse(e)}catch(t){return m.fail&&"function"==typeof m.fail&&m.fail(b,o,e),void i._alert("‰∏ä‰º†ÂõæÁâáÂ§±Ë¥•","‰∏ä‰º†ÂõæÁâáËøîÂõûÁªìÊûúÈîôËØØÔºåËøîÂõûÁªìÊûúÊòØ: "+e)}if(m.customInsert||"0"===e.errno){if(m.customInsert&&"function"==typeof m.customInsert)m.customInsert(i.insertLinkImg.bind(i),e,o);else(e.data||[]).forEach(function(t){i.insertLinkImg(t)});m.success&&"function"==typeof m.success&&m.success(b,o,e)}else m.fail&&"function"==typeof m.fail&&m.fail(b,o,e),i._alert("‰∏ä‰º†ÂõæÁâáÂ§±Ë¥•","‰∏ä‰º†ÂõæÁâáËøîÂõûÁªìÊûúÈîôËØØÔºåËøîÂõûÁªìÊûú errno="+e.errno)}},m.before&&"function"==typeof m.before){var $=m.before(b,o,g);if($&&"object"===_typeof($)&&$.prevent)return void this._alert($.msg)}return objForEach(h,function(t,e){b.setRequestHeader(t,e)}),b.withCredentials=p,void b.send(w)}r&&arrForEach(t,function(t){var e=i,n=new FileReader;n.readAsDataURL(t),n.onload=function(){e.insertLinkImg(this.result)}})}}}}};var editorId=1;function Editor(t,e){if(null===t)throw new Error("ÈîôËØØÔºöÂàùÂßãÂåñÁºñËæëÂô®Êó∂ÂÄôÊú™‰º†ÂÖ•‰ªª‰ΩïÂèÇÊï∞ÔºåËØ∑Êü•ÈòÖÊñáÊ°£");this.id="wangEditor-"+editorId++,this.toolbarSelector=t,this.textSelector=e,this.customConfig={}}if(Editor.prototype={constructor:Editor,_initConfig:function(){this.config=Object.assign({},config,this.customConfig);var t=this.config.lang||{},n=[];objForEach(t,function(t,e){n.push({reg:new RegExp(t,"img"),val:e})}),this.config.langArgs=n},_initDom:function(){var o,t,r,e,a=this,n=$(this.toolbarSelector),i=this.textSelector,s=this.config,c=s.zIndex;null==i?(o=$("<div></div>"),t=$("<div></div>"),e=n.children(),n.append(o).append(t),o.css("background-color","#f1f1f1").css("border","1px solid #ccc"),t.css("border","1px solid #ccc").css("border-top","none").css("height","300px")):(o=n,e=(t=$(i)).children()),(r=$("<div></div>")).attr("contenteditable","true").css("width","100%").css("height","100%"),e&&e.length?r.append(e):r.append($("<p><br></p>")),t.append(r),o.addClass("w-e-toolbar"),t.addClass("w-e-text-container"),t.css("z-index",c),r.addClass("w-e-text");var l=getRandom("toolbar-elem");o.attr("id",l);var u=getRandom("text-elem");r.attr("id",u),this.$toolbarElem=o,this.$textContainerElem=t,this.$textElem=r,this.toolbarElemId=l,this.textElemId=u;var d=!0;t.on("compositionstart",function(){d=!1}),t.on("compositionend",function(){d=!0}),t.on("click keyup",function(){d&&a.change&&a.change()}),o.on("click",function(){this.change&&this.change()}),(s.onfocus||s.onblur)&&(this.isFocus=!1,$(document).on("click",function(t){var e=r.isContain($(t.target)),n=o.isContain($(t.target)),i=o[0]===t.target;if(e)a.isFocus||a.onfocus&&a.onfocus(),a.isFocus=!0;else{if(n&&!i)return;a.isFocus&&a.onblur&&a.onblur(),a.isFocus=!1}}))},_initCommand:function(){this.cmd=new Command(this)},_initSelectionAPI:function(){this.selection=new API(this)},_initUploadImg:function(){this.uploadImg=new UploadImg(this)},_initMenus:function(){this.menus=new Menus(this),this.menus.init()},_initText:function(){this.txt=new Text(this),this.txt.init()},initSelection:function(t){var e=this.$textElem,n=e.children();if(!n.length)return e.append($("<p><br></p>")),void this.initSelection();var i=n.last();if(t){var o=i.html().toLowerCase(),r=i.getNodeName();if("<br>"!==o&&"<br/>"!==o||"P"!==r)return e.append($("<p><br></p>")),void this.initSelection()}this.selection.createRangeByElem(i,!1,!0),this.selection.restoreSelection()},_bindEvent:function(){var e=0,n=this.txt.html(),t=this.config,i=t.onchangeTimeout;(!(i=parseInt(i,10))||i<=0)&&(i=200);var o=t.onchange;o&&"function"==typeof o&&(this.change=function(){var t=this.txt.html();t.length===n.length&&t===n||(e&&clearTimeout(e),e=setTimeout(function(){o(t),n=t},i))});var r=t.onblur;r&&"function"==typeof r&&(this.onblur=function(){var t=this.txt.html();r(t)});var a=t.onfocus;a&&"function"==typeof a&&(this.onfocus=function(){a()})},create:function(){this._initConfig(),this._initDom(),this._initCommand(),this._initSelectionAPI(),this._initText(),this._initMenus(),this._initUploadImg(),this.initSelection(!0),this._bindEvent()},_offAllEvent:function(){$.offAll()}},"undefined"==typeof window)throw new Error("ËØ∑Âú®ÊµèËßàÂô®ÁéØÂ¢É‰∏ãËøêË°å");module.exports=Editor;
